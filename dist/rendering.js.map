{"version":3,"sources":["../src/rendering.js"],"names":["link","scope","elem","attrs","ctrl","data","columns","panel","svgWrapper","highlight_text","tooltipEle","find","captionEle","theme","grafanaBootData","user","lightTheme","events","on","render","setElementHeight","height","row","_","isString","parseInt","replace","title","css","e","showError","errorText","noData","text","show","hide","addZoom","svg","select","call","d3","zoom","scale","event","transform","k","translate","x","y","attr","d","i","y_plus_5","tooltipEvals","parseTooltip","tooltip","columnTexts","regExp","tooltipEval","$sanitize","match","exec","index","indexOf","replaceWith","createTooltipEvals","firstTooltip","first_term_tooltip","tooltipEvalText1","length","$interpolate","secondTooltip","second_term_tooltip","tooltipEvalText2","combineFieldIndex","combine_to_show","showWhichIndex","addNetworkChart","width","color","scaleOrdinal","color_scale","noise","remove_noise","nodes_noise","nodes_remove_noise","colorSelections","map","default_index1","color_regexp1","color_data_index1","default_index2","color_regexp2","color_data_index2","selector","first_color_selector","push","RegExp","first_color_regexp","second_color_selector","style","showTooltip","transition","duration","html","pageX","pageY","hideTooltip","totals","linkData","nodesData","combine_active","sourceIndex","targetIndex","allSources","allTargets","forEach","value","source","target","initHash","group","getGroup","combineMethod","combine_method","relations","currentRel","sourceFromTarget","hide_internal_relationships","param","relation1","relation2","setTotalsHash","addFirst","addSecond","id","getTotalTooltip","firstNode","secondNode","uniqBy","linkUpdate","selectAll","exit","remove","enter","append","link_thickness","dynamic_thickness","Math","log","merge","maxValueLogged","reduce","max","nodeUpdate","nodeEnter","drag","dragstarted","dragged","dragended","radius","node_radius","distance","link_distance","simulation","forceSimulation","force","forceLink","strength","forceManyBody","forceCenter","nodes","ticked","links","captions","columnsSorted","sortBy","captionsUpdate","captionsEnter","colorTexts","checkHighlight","toLowerCase","alphaTarget","cx","cy","delay","prev_highlight_text","active","restart","fx","fy","hash","key","count","default_index","selectorData","result","undefined","totalObj","_error","renderingCompleted"],"mappings":"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","file":"rendering.js","sourcesContent":["import _ from 'lodash';\n//import * as d3 from 'd3';\n//import {event as currentEvent} from './d3-selection';\n\nexport default function link(scope, elem, attrs, ctrl) {\n  var data,columns, panel, svgWrapper, highlight_text ;\n  var tooltipEle = elem.find('.tooltip');\n  var captionEle = elem.find('.caption');\n\n  var theme = grafanaBootData.user.lightTheme ? '-light' : '-dark' ;\n\n  elem = elem.find('.networkchart-panel');\n\n\n  ctrl.events.on('render', function() {\n    render();\n  });\n\n  function setElementHeight() {\n    try {\n      var height = ctrl.height || panel.height || ctrl.row.height;\n      if (_.isString(height)) {\n        height = parseInt(height.replace('px', ''), 10);\n      }\n\n      height -= 5; // padding\n      height -= panel.title ? 24 : 9; // subtract panel title bar\n\n      elem.css('height', height + 'px');\n\n      return true;\n    } catch(e) { // IE throws errors sometimes\n      return false;\n    }\n  }\n\n\n  function showError(errorText) {\n    var noData = elem.find(\".no-data\");\n    if(errorText){\n      noData.text(errorText);\n      noData.show();\n    }\n    else\n      noData.hide();\n  }\n\n  function addZoom(svg){\n    svgWrapper = svg.select('.svg-wrapper');\n\n    svg.call(d3.zoom().on('zoom', function() {\n\n      var scale = d3.event.transform.k,\n      translate = [d3.event.transform.x, d3.event.transform.y];\n\n       svgWrapper.attr('transform', 'translate(' + translate[0] + ', ' + translate[1] + ') scale(' + scale + ')');\n   }));\n  }\n\n\n  function y(d,i){\n    return 25 * (i+1)\n  }\n\n  function y_plus_5(d,i){\n    return y(d,i) + 5\n  }\n\n\n  var tooltipEvals = [];\n\n  function parseTooltip(tooltip,columnTexts){\n      var regExp=/{{(.*?)}}/g;    \n      var tooltipEval = ctrl.$sanitize(tooltip);\n      var match;\n      do {\n          match = regExp.exec(tooltip);\n          if (match){\n            var index = columnTexts.indexOf(match[1]);\n            var replaceWith = index!== -1 ? `d[${index}]` : \"\";\n\n            tooltipEval = tooltipEval.replace(match[1], replaceWith)\n          }\n      } while (match);\n\n      return tooltipEval;\n  }\n\n  function createTooltipEvals(columnTexts){\n\n    var firstTooltip = ctrl.panel.first_term_tooltip;\n\n    var tooltipEvalText1 = firstTooltip && columnTexts && columnTexts.length? parseTooltip(firstTooltip,columnTexts) : \"{{d[0]}}\";\n    tooltipEvals[0] = ctrl.$interpolate(tooltipEvalText1);\n\n\n    var secondTooltip = ctrl.panel.second_term_tooltip;\n\n    var tooltipEvalText2 =secondTooltip && columnTexts && columnTexts.length? parseTooltip(secondTooltip,columnTexts) : \"{{d[1]}}\";\n    tooltipEvals[1] = ctrl.$interpolate(tooltipEvalText2);\n  }\n\n  function combineFieldIndex(columnTexts){\n    if(ctrl.panel.combine_to_show){\n      var showWhichIndex  = columnTexts.indexOf(ctrl.panel.combine_to_show);\n\n      if(showWhichIndex !== -1)\n        return showWhichIndex;\n    }\n\n    return 0;\n  }\n\n\n  function addNetworkChart() {\n    if(typeof d3 == 'undefined')\n      return;\n\n    var width = elem.width();\n    var height = elem.height();\n\n    var color = d3.scaleOrdinal(d3[ctrl.panel.color_scale]);\n\n\n    var noise = ctrl.panel.remove_noise ? ctrl.panel.noise : 3;\n    var nodes_noise = ctrl.panel.nodes_remove_noise ? ctrl.panel.nodes_noise : 0; \n    \n    //************************ Init Caption and Colors Data *************************/\n    var colorSelections = {};\n    var columns = [];\n    var columnTexts = _.map(ctrl.columns,\"text\")\n\n    var default_index1;\n    var color_regexp1;\n    var color_data_index1 = null;\n    \n    var default_index2;\n    var color_regexp2;\n    var color_data_index2 = null;\n\n\n    var selector = ctrl.panel.first_color_selector;\n    if(selector === 'index'){\n      default_index1= columns.length; \n      columns.push(ctrl.columns[0])\n    }\n    else if(selector === 'regular expression')\n      color_regexp1 = new RegExp(ctrl.panel.first_color_regexp);\n    else\n      color_data_index1 =  columnTexts.indexOf(selector); \n\n\n    selector = ctrl.panel.second_color_selector;\n    if(selector === 'index'){\n      default_index2= columns.length;\n      columns.push(ctrl.columns[1])\n    }\n    else if(selector === 'regular expression')\n      color_regexp2 = new RegExp(ctrl.panel.first_color_regexp);\n    else\n      color_data_index2 =  columnTexts.indexOf(selector);\n\n\n    //************************ Tooltips *************************/\n\n    createTooltipEvals(columnTexts);\n\n    var tooltip = d3.select(tooltipEle[0])\n                  .style(\"opacity\", 0);\n\n\n    function showTooltip(d) {    \n      tooltip.transition()\n          .duration(200)\n          .style(\"opacity\", .8);\n\n      tooltip.html(d.tooltip)  \n          .style(\"width\",  (d.tooltip.length * 7) + \"px\")\n          .style(\"left\",  (d3.event.pageX) + \"px\")   \n          .style(\"top\",   (d3.event.pageY - 28) + \"px\")\n      }\n\n\n      function hideTooltip(d) {\n          tooltip.transition()    \n              .duration(500)    \n              .style(\"opacity\", 0); \n      }\n\n\n    //************************ Main Graph *************************/\n  \n    var svg = d3.select(elem[0]);\n\n    addZoom(svg);\n\n\n    //************************ Links between nodes *************************/\n\n    var totals = {};\n    var linkData = [];\n    var nodesData = [];\n\n    if(ctrl.panel.combine_active){\n      var sourceIndex =combineFieldIndex(columnTexts);\n      var targetIndex = +!sourceIndex ;\n\n      var allSources= {};\n      var allTargets= {};\n\n      _.forEach(data, d => {\n\n        var value = d[d.length-1];\n        //No value\n        if(!value || value < noise)\n          return ;\n\n        var source = d[sourceIndex];\n        var target = d[targetIndex];\n\n        initHash(allSources, source);\n        initHash(allTargets, target);\n\n        allSources[source][target] = value;\n        allTargets[target][source] = value;\n\n        allSources[source].tooltip = tooltipEvals[sourceIndex]({d: d})\n\n        if(color_data_index1 !== null || color_regexp1)\n          allSources[source].group = getGroup(d,sourceIndex);  \n      });\n\n      var combineMethod = _[ctrl.panel.combine_method];\n\n      var relations = {};\n\n      for (var source in allSources) {\n\n        initHash(relations,source);\n        var currentRel = relations[source];\n\n        for (var target in allSources[source]) {\n\n          var value = allSources[source][target];\n\n          for (var sourceFromTarget in allTargets[target]) {\n\n            //Already calculated at the other end\n            if(relations[sourceFromTarget]) continue;\n\n            if(ctrl.panel.hide_internal_relationships && allSources[source].group === allSources[sourceFromTarget].group )\n                continue;\n\n            if(!currentRel[sourceFromTarget]) currentRel[sourceFromTarget] = 0;\n\n            var param = [value , allTargets[target][sourceFromTarget] ];\n            currentRel[sourceFromTarget] += combineMethod(param);\n          }\n        }\n      }\n\n      for (var relation1 in relations) {\n        for (var relation2 in relations[relation1]) {\n\n          var value = relations[relation1][relation2];\n\n          setTotalsHash(totals, relation1, value);\n          setTotalsHash(totals, relation2, value);\n        }\n      }\n\n      for (var relation1 in relations) {\n        for (var relation2 in relations[relation1]) {          \n          var addFirst = totals[relation1].value > nodes_noise;\n          var addSecond = totals[relation2].value > nodes_noise;\n\n          if(!addFirst && !addSecond)\n            continue;\n\n            nodesData.push({\n              id: relation1 ,\n              group: allSources[relation1].group,\n              tooltip: allSources[relation1].tooltip + getTotalTooltip(relation1)\n            });\n\n            nodesData.push({\n              id: relation2 ,\n              group: allSources[relation2].group ,\n              tooltip: allSources[relation2].tooltip + getTotalTooltip(relation2)\n            });\n                      \n            var value = relations[relation1][relation2];\n\n            linkData.push({\n                  id: relation1 + relation2, \n                  source: relation1,\n                  target: relation2,\n                  value:  value,\n                  tooltip: relation1+ ' <=> ' + relation2 + '<br>' + value\n                });\n        }\n      }\n\n\n    }\n\n    else\n    {\n      _.forEach(data, d => {\n        var value = d[d.length-1];\n\n        if(!value || value < noise)\n          return;\n        \n        setTotalsHash(totals, d[0], value);\n        setTotalsHash(totals, d[1], value);\n      });\n\n\n      _.forEach(data, d => {\n        var value = d[d.length-1];\n\n        if(!value || value < noise)\n          return;\n\n\n        var  firstNode = d[0];\n        var  secondNode = d[1];\n\n        if(nodes_noise){\n          var addFirst  = totals[firstNode].value > nodes_noise;\n          var addSecond = totals[secondNode].value > nodes_noise;\n          \n          if(!addFirst && !addSecond)\n            return;\n        }\n\n        linkData.push({\n            id: firstNode + secondNode, \n            source: firstNode,\n            target: secondNode,\n            value:  value,\n            tooltip: firstNode + \" <=> \" + secondNode + \" <br> \" + value\n          });\n\n        nodesData.push({\n            id: firstNode, \n            group: getGroup(d, 0),\n            tooltip: tooltipEvals[0]({d: d}) + getTotalTooltip(firstNode)\n          }); //columns[i].text\n        \n        nodesData.push({\n            id: secondNode, \n            group: getGroup(d, 1),\n            tooltip: tooltipEvals[1]({d: d}) + getTotalTooltip(secondNode)\n          }); //columns[i].text\n      });\n\n    \n    }\n\n    nodesData = _.uniqBy(nodesData, d => d.id);\n\n\n    //************************ Links d3 *************************/\n\n\n    var linkUpdate = svg.select(\".links\")\n                    .selectAll(\"line\")\n                    .data(linkData, d => d.id);\n\n    // EXIT\n    // Remove old elements as needed.\n    linkUpdate.exit().remove();\n\n    // ENTER\n    // Create new elements as needed.  \n    var enter = linkUpdate.enter().append(\"line\")\n                .attr(\"class\", \"line\"+theme)\n                .on(\"mouseover\", showTooltip)\n                .on(\"mouseout\", hideTooltip)\n\n    /*\n    enter    \n      .append(\"title\")\n      .text(d => d.id)\n    */\n\n    var link_thickness = ctrl.panel.link_thickness;\n\n    if(ctrl.panel.dynamic_thickness)\n      link_thickness = d => Math.log(d.value)\n\n    // ENTER + UPDATE\n    linkUpdate =linkUpdate.merge(enter)\n                //.selectAll(\"line\")\n                .attr(\"stroke-width\", link_thickness );\n\n\n    var maxValueLogged = _.reduce(linkData, (max, d) =>{\n      var log = Math.log(d.value);\n      if(log > max)\n        return log;\n\n      return max;\n    },0);\n\n\n    //************************ NODES d3 *************************/\n\n\n    var nodeUpdate = svg.select(\".nodes\")\n                    .selectAll('circle')\n                    .data(nodesData, d => d.id + '-node');\n\n    // EXIT\n    // Remove old elements as needed.\n    nodeUpdate.exit().remove();\n\n    // ENTER\n    // Create new elements as needed.  \n    var nodeEnter = nodeUpdate.enter().append(\"circle\")\n              .on(\"mouseover\", showTooltip)\n              .on(\"mouseout\", hideTooltip)\n              .call(d3.drag()\n                .on(\"start\", dragstarted)\n                .on(\"drag\", dragged)\n                .on(\"end\", dragended));\n\n\n    /*                    \n    nodeEnter   \n        .append(\"title\")\n        .text(d => d.id);\n    */\n\n    var radius = ctrl.panel.node_radius\n\n\n    // ENTER + UPDATE\n    nodeUpdate = nodeUpdate.merge(nodeEnter)\n      //.selectAll(\"circle\")\n      .attr(\"r\", radius) // TODO use cummulative value for this\n      .attr(\"fill\", d => d.group ? color(d.group) : color(0) )\n\n\n\n    var distance = ctrl.panel.link_distance || 20;\n\n    var simulation = d3.forceSimulation()\n      .force(\"link\", d3.forceLink()\n        .id(d => d.id) \n        .distance(distance)\n        .strength(d => { \n\n        if(!d.value)\n          return 0.01;\n\n        var strength = Math.log(d.value)/maxValueLogged;\n        if(strength < 0.01)\n          return 0.01;\n\n        return strength;\n        })\n      )\n      .force(\"charge\", d3.forceManyBody())\n      .force(\"center\", d3.forceCenter(width / 2, height / 2));\n\n    simulation\n      .nodes(nodesData)\n      .on(\"tick\", ticked);\n\n    simulation.force(\"link\")\n          .links(linkData);\n\n\n    //************************ Add Caption Colors *************************/\n    var captions = d3.select(captionEle[0]);\n\n    var columnsSorted = _.sortBy(columns,\"text\")\n    \n    var captionsUpdate = captions.selectAll(\"g\")\n                        .data(columnsSorted, (d,i) => d.text+i);\n\n    // EXIT\n    // Remove old elements as needed.\n    captionsUpdate.exit().remove();\n\n    // ENTER\n    // Create new elements as needed.  \n    var captionsEnter = captionsUpdate.enter()\n                        .append(\"g\");\n\n\n    captionsEnter\n      .append(\"circle\")\n      .attr(\"r\", 10)\n      .attr(\"cx\", 15)\n      .attr(\"cy\", y)\n\n\n    captionsEnter\n      .append(\"text\")\n      .attr(\"class\", \"captions-text\" + theme)\n      .attr(\"x\", 25)\n      .attr(\"y\", y_plus_5);\n\n    \n    var colorTexts = _.map(columns,\"text\")\n\n    // ENTER + UPDATE\n    captionsUpdate.merge(captionsEnter)\n      .selectAll('circle')\n      //.attr(\"fill\", (d,i) => color(i)  )\n      .attr(\"fill\", d => color( colorTexts.indexOf(d.text))  )\n\n\n\n    captionsUpdate.merge(captionsEnter)\n      .selectAll('text')\n      .text(d => d.text);\n\n\n\n    function checkHighlight(d) {\n      return d.tooltip.toLowerCase().indexOf(highlight_text) !== -1\n    }\n\n    if(ctrl.highlight_text) {\n\n      highlight_text = ctrl.highlight_text.toLowerCase()\n\n      //stop simiulation\n      simulation.alphaTarget(0);\n\n      var cx,cy;\n\n      nodeUpdate\n        .transition()\n        .duration(1000)  \n        .delay(2000) \n        .attr(\"r\", d => checkHighlight(d) ? radius*7 : radius)\n        .attr(\"stroke\", d => checkHighlight(d) ? \"lightblue\" : \"\")\n        .attr(\"stroke-width\", d => checkHighlight(d) ? 2 : \"\")\n        .transition()\n        .duration(1000)  \n        .delay(1000) \n        .attr(\"r\", radius)\n\n\n\n    }\n    else if(ctrl.prev_highlight_text)\n    {\n      nodeUpdate\n      .attr(\"stroke\", \"\")\n      .attr(\"stroke-width\", \"\")\n    }\n\n\n\n    function ticked() {\n      linkUpdate\n          .attr(\"x1\", function(d) { return d.source.x; })\n          .attr(\"y1\", function(d) { return d.source.y; })\n          .attr(\"x2\", function(d) { return d.target.x; })\n          .attr(\"y2\", function(d) { return d.target.y; });\n\n      nodeUpdate\n          .attr(\"cx\", function(d) { return d.x; })\n          .attr(\"cy\", function(d) { return d.y; });\n    }\n\n    function dragstarted(d) {\n      if (!d3.event.active) simulation.alphaTarget(0.3).restart();\n      d.fx = d.x;\n      d.fy = d.y;\n    }\n\n    function dragged(d) {\n      d.fx = d3.event.x;\n      d.fy = d3.event.y;\n    }\n\n    function dragended(d) {\n      if (!d3.event.active) simulation.alphaTarget(0);\n      d.fx = null;\n      d.fy = null;\n    }\n\n    function initHash(hash,key) {\n      if (!hash[key]){\n        hash[key]= {};\n        return true;\n      }\n\n      return false;\n    }\n\n\n    function setTotalsHash(hash,key, value){\n      if(initHash(hash,key)){\n        hash[key].count = 0;\n        hash[key].value = 0;\n      }\n      hash[key].value += value;\n      hash[key].count ++;\n    }\n\n\n    function getGroup(d,index ){\n      var group;\n      var default_index = index === 0 ? default_index1 : default_index2;\n      var selector = index === 0 ? color_data_index1 : color_data_index2;\n      var regExp = index === 0 ? color_regexp1 : color_regexp2;\n      \n      var selectorData ;\n      \n      if(selector !== null)\n        selectorData = d[selector];\n\n      if(regExp){\n        var result =regExp.exec(d[index]);\n\n        if(result.length)\n          selectorData = result[result.length-1];\n      }\n\n      if(selectorData){\n        group = colorSelections[selectorData];\n        if(group === undefined)\n        {\n          group = colorSelections[selectorData] = columns.length;\n          columns.push({\n            text: selectorData\n          });\n        }\n      }\n      else\n        group = default_index;\n\n      return group;\n    }\n\n\n\n    function getTotalTooltip(key){\n      var totalObj = totals[key];\n      return \"<br/> Total:\" + totalObj.value + \"&nbsp;&nbsp; Edge Count:\"  + totalObj.count;\n    }\n\n  }\n\n\n  function render() {\n    data = ctrl.data;\n    columns = ctrl.columns;\n    panel = ctrl.panel;\n\n    if (setElementHeight())\n\n      if(ctrl._error || !data || !data.length)\n      {\n\n        showError(ctrl._error || \"No data points\");\n        \n        data = [];\n        addNetworkChart();\n\n      }\n      else\n      {\n        addNetworkChart();\n        showError(false);  \n      }\n\n    \n    ctrl.renderingCompleted();\n  }\n}\n\n"]}